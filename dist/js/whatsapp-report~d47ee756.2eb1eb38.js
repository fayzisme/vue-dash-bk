(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["whatsapp-report~d47ee756"],{"255f":function(t,e,a){"use strict";a("927d")},"927d":function(t,e,a){},"9b66":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loadingPage,expression:"loadingPage"}],staticClass:"scrollable only-y"},[t._m(0),t.showAlertMessage?r("el-card",{attrs:{align:"center"}},[r("h2",{attrs:{align:"center"}},[t._v("Start messaging your customers today")]),r("p",{domProps:{innerHTML:t._s(t.$t("promote.desc.whatsapp"))}}),r("br"),r("br"),r("span",[r("el-button",{on:{click:function(e){return t.mailto()}}},[t._v("Send us e-mail")])],1),2==t.customer_type&&void 0==t.businessId&&""==t.businessId?r("div",{staticStyle:{margin:"0 0 20px"}},[r("button",{staticStyle:{"background-color":"#1877f2",border:"0","border-radius":"23px",color:"#fff",cursor:"pointer","font-family":"Helvetica, Arial, sans-serif","font-size":"14px","font-weight":"bold",height:"40px",padding:"0 24px"},attrs:{onclick:"launchWhatsAppSignup()"}},[t._v("Connect to Facebook")])]):t._e()]):r("span",[r("el-tabs",{attrs:{type:"border-card"},on:{"tab-click":t.tabClick},model:{value:t.activeTab,callback:function(e){t.activeTab=e},expression:"activeTab"}},[r("el-tab-pane",{attrs:{label:"Report",name:"report"}},[t.showAlertMessage||t.showAlertError?t._e():r("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0}},[r("el-form-item",[r("el-date-picker",{staticStyle:{width:"275px"},attrs:{size:"mini","picker-options":t.pickerOptions,"unlink-panels":!0,editable:!1,type:"daterange","range-separator":"To","start-placeholder":"Start date","end-placeholder":"End date"},model:{value:t.selectedStartDate,callback:function(e){t.selectedStartDate=e},expression:"selectedStartDate"}})],1),r("el-form-item",[r("el-select",{staticStyle:{width:"150px"},attrs:{size:"mini",placeholder:"Select Phone Number","default-first-option":!0},model:{value:t.sender,callback:function(e){t.sender=e},expression:"sender"}},t._l(t.waUserDetail.sender,(function(t){return r("el-option",{key:t,staticStyle:{width:"150px"},attrs:{label:t,value:t}})})),1)],1),r("el-form-item",[r("el-select",{staticStyle:{float:"left",width:"150px"},attrs:{placeholder:"Filter by",size:"mini"},model:{value:t.valueFilter,callback:function(e){t.valueFilter=e},expression:"valueFilter"}},t._l(t.optionsFilter,(function(t){return r("el-option",{key:t.value,attrs:{value:t.value,label:t.label}})})),1)],1),r("el-form-item",[r("el-input",{staticClass:"search-contact",staticStyle:{float:"left !important",width:"150px"},attrs:{size:"mini","prefix-icon":"el-icon-search",placeholder:"Search data",clearable:""},model:{value:t.searchingData,callback:function(e){t.searchingData=e},expression:"searchingData"}})],1),r("el-form-item",[r("el-button",{staticClass:"animated fadeInRight",attrs:{type:"primary",size:"mini"},on:{click:t.changeFilter}},[r("i",{staticClass:"el-icon-search"})])],1),r("el-form-item",[r("el-button",{staticClass:"animated fadeInRight",attrs:{type:"primary",size:"mini"},on:{click:t.downloadExcel}},[r("i",{staticClass:"mdi mdi-download"})])],1)],1),r("el-dialog",{staticStyle:{"text-align":"left"},attrs:{title:"Message status history",visible:t.modalInvalid},on:{"update:visible":function(e){t.modalInvalid=e}}},[r("vue-json-pretty",{attrs:{path:"res",data:t.selectedRows}})],1),t.showAlertMessage||t.showAlertError?t._e():r("el-row",{staticStyle:{"z-index":"0"},attrs:{gutter:10}},[r("el-col",{staticClass:"mt-10",attrs:{xs:24,sm:24,md:24,lg:24,xl:24}},[r("el-card",{attrs:{shadow:"card-shadow--small"}},[r("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loadingPage,expression:"loadingPage"}],staticClass:"group-list scrollable only-y"},[r("el-row",{staticClass:"mb-20",staticStyle:{"font-size":"14px"}},[r("el-col",{directives:[{name:"loading",rawName:"v-loading",value:t.loadingReportTable,expression:"loadingReportTable"}],attrs:{span:4,md:4,sm:4,xs:4,justify:"end"}},[r("el-card",{staticClass:"mb-10",staticStyle:{"background-color":"#249393","font-size":"12px",color:"#ffffff","font-weight":"bold"}},[r("span",{staticStyle:{"font-size":"14px"}},[t._v("Total")]),r("br"),t.sender?r("span",{staticStyle:{"font-size":"16px"}},[t._v(" "+t._s(t.resData.status.all))]):r("span",{staticStyle:{"font-size":"16px"}},[t._v(" -")])])],1),r("el-col",{directives:[{name:"loading",rawName:"v-loading",value:t.loadingReportTable,expression:"loadingReportTable"}],attrs:{span:4,md:4,sm:4,xs:4,justify:"end"}},[r("el-card",{staticClass:"mb-10",staticStyle:{"background-color":"#1d808a","font-size":"12px",color:"#ffffff","font-weight":"bold"}},[r("span",{staticStyle:{"font-size":"14px"}},[t._v("Sent")]),r("br"),t.sender?r("span",{staticStyle:{"font-size":"16px"}},[t._v(" "+t._s(t.resData.status.sent))]):r("span",{staticStyle:{"font-size":"16px"}},[t._v(" -")])])],1),r("el-col",{directives:[{name:"loading",rawName:"v-loading",value:t.loadingReportTable,expression:"loadingReportTable"}],attrs:{span:4,md:4,sm:4,xs:4,justify:"end"}},[r("el-card",{staticClass:"mb-10",staticStyle:{"background-color":"#166d81","font-size":"12px",color:"#ffffff","font-weight":"bold"}},[r("span",{staticStyle:{"font-size":"14px"}},[t._v("Delivered")]),r("br"),t.sender?r("span",{staticStyle:{"font-size":"16px"}},[t._v(" "+t._s(t.resData.status.delivered))]):r("span",{staticStyle:{"font-size":"16px"}},[t._v(" -")])])],1),r("el-col",{directives:[{name:"loading",rawName:"v-loading",value:t.loadingReportTable,expression:"loadingReportTable"}],attrs:{span:4,md:4,sm:4,xs:4,justify:"end"}},[r("el-card",{staticClass:"mb-10",staticStyle:{"background-color":"#0e5978","font-size":"12px",color:"#ffffff","font-weight":"bold"}},[r("span",{staticStyle:{"font-size":"14px"}},[t._v("Read")]),r("br"),t.sender?r("span",{staticStyle:{"font-size":"16px"}},[t._v(" "+t._s(t.resData.status.read))]):r("span",{staticStyle:{"font-size":"16px"}},[t._v(" -")])])],1),r("el-col",{directives:[{name:"loading",rawName:"v-loading",value:t.loadingReportTable,expression:"loadingReportTable"}],attrs:{span:4,md:4,sm:4,xs:4,justify:"end"}},[r("el-card",{staticClass:"mb-10",staticStyle:{"background-color":"#07466f","font-size":"12px",color:"#ffffff","font-weight":"bold"}},[r("span",{staticStyle:{"font-size":"14px"}},[t._v("Failed")]),r("br"),t.sender?r("span",{staticStyle:{"font-size":"16px"}},[t._v(" "+t._s(t.resData.status.failed))]):r("span",{staticStyle:{"font-size":"16px"}},[t._v(" -")])])],1),r("el-col",{directives:[{name:"loading",rawName:"v-loading",value:t.loadingReportTable,expression:"loadingReportTable"}],attrs:{span:4,md:4,sm:4,xs:4,justify:"end"}},[r("el-card",{staticClass:"mb-10",staticStyle:{"background-color":"#003366","font-size":"12px",color:"#ffffff","font-weight":"bold"}},[r("span",{staticStyle:{"font-size":"14px"}},[t._v("Invalid")]),r("br"),t.sender?r("span",{staticStyle:{"font-size":"16px"}},[t._v(" "+t._s(t.resData.status.invalid))]):r("span",{staticStyle:{"font-size":"16px"}},[t._v(" -")])])],1)],1),r("el-pagination",{attrs:{background:"","prev-text":"Prev","next-text":"Next",layout:"prev, pager, next","page-size":50,"current-page":t.currentPage,total:t.total},on:{"current-change":t.paginateReport}}),[r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loadingTable,expression:"loadingTable"}],staticStyle:{width:"100%",color:"#000 !important"},attrs:{data:t.messages,"element-loading-text":"Loading...","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(246, 246, 245, 0.8)"}},[r("el-table-column",{attrs:{width:"170",prop:"dateTime",label:"Date"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.format(e.row.created_date,"DD/MM/YYYY, HH:mm"))+" ")]}}],null,!1,1235930702)}),r("el-table-column",{attrs:{width:"150",prop:"sender",label:"From"}}),r("el-table-column",{attrs:{width:"150",prop:"to",label:"To"}}),r("el-table-column",{attrs:{prop:"type",label:"Type",width:"250"}}),r("el-table-column",{attrs:{prop:"msg_id",label:"Message ID",width:"300"}}),r("el-table-column",{attrs:{prop:"status",label:"Status",align:"center",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return["processing"==e.row.status?r("p",[r("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"On process",placement:"top"}},[r("span",{staticClass:"mdi mdi-clock"})])],1):"sent"==e.row.status?r("p",[r("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"Message was sent",placement:"top"}},[r("span",{staticClass:"mdi mdi-check"})])],1):"delivered"==e.row.status?r("p",[r("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"Message was delivered",placement:"top"}},[r("span",{staticClass:"mdi mdi-check-all"})])],1):"read"==e.row.status?r("p",[r("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"Message was read",placement:"top"}},[r("span",{staticClass:"mdi mdi-check-all",staticStyle:{color:"#249393","font-weight":"bold"}})])],1):"fail"==e.row.status||"failed"==e.row.status?r("p",[r("el-tooltip",{attrs:{placement:"top"}},[r("div",{staticClass:"tooltip",staticStyle:{"max-width":"250px"},attrs:{slot:"content"},slot:"content"},[t._v(t._s(t.errorMessage(e.row)))]),r("span",{staticClass:"mdi mdi-close-circle-outline",staticStyle:{color:"red","font-weight":"bold"}})])],1):"invalid"==e.row.status?r("p",[r("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"Invalid",placement:"top"}},[r("span",{staticClass:"mdi mdi-close-circle-outline",staticStyle:{color:"red","font-weight":"bold"},on:{click:function(a){t.modalInvalid=!0,t.selectedRows=e.row.transaction_status}}})])],1):"scheduled"==e.row.status?r("p",[r("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"Scheduled",placement:"top"}},[r("span",{staticClass:"mdi mdi-calendar-clock"})])],1):t._e()]}}],null,!1,3268829663)}),r("el-table-column",{attrs:{prop:"latest_status_dt",label:"Update Status Date",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.format(e.row.latest_status_dt,"DD/MM/YYYY, HH:mm"))+" ")]}}],null,!1,2588025370)}),r("template",{staticStyle:{height:"500px"},slot:"empty"},[r("p",[r("img",{attrs:{src:a("7e53"),width:"100"}}),r("br"),t._v("No data ")])])],2)],r("el-pagination",{staticClass:"mt-10",attrs:{background:"","prev-text":"Prev","next-text":"Next",layout:"prev, pager, next","page-size":50,"current-page":t.currentPage,total:t.total},on:{"current-change":t.paginateReport}})],2)])],1)],1)],1),r("el-tab-pane",{attrs:{label:"Download",name:"download"}},[r("div",{directives:[{name:"loading",rawName:"v-loading",value:t.reportTabLoading,expression:"reportTabLoading"}],staticClass:"scrollable only-y"},[r("el-row",{attrs:{gutter:30}},[r("el-col",{attrs:{xs:24,sm:24,md:24,lg:24,xl:24}},[t._l(t.lists,(function(e,a){return r("el-card",{key:a,staticClass:"page-header box-card card-base",staticStyle:{border:"1px solid #ebeef5"}},[r("el-row",{attrs:{gutter:30}},[r("el-col",{attrs:{xs:2,sm:2,md:2,lg:2,xl:2}},[r("div",[r("i",{staticClass:"mdi mdi-file",staticStyle:{"font-size":"24px","line-height":"100px"}})])]),r("el-col",{attrs:{xs:20,sm:20,md:20,lg:20,xl:20}},[r("span",[r("h2",{staticClass:"no-m accent-text"},[t._v(t._s(e.title))]),r("p",{staticClass:"no-m",staticStyle:{"font-size":"14px"}},[t._v(" Report filter detail: "),r("ul",[r("li",[t._v("Start date: "+t._s(e.parameter.startDate))]),r("li",[t._v("End date: "+t._s(e.parameter.endDate))]),r("li",[t._v("Phone number: "+t._s(e.parameter.number))])]),r("br"),t._v(" Request at: "+t._s(t.format(e.createdAt,"DD MMM YYYY, HH:mm"))+" ")]),r("br"),"done"==e.status?r("a",{staticClass:"el-button el-button--primary el-button--mini",attrs:{target:"_blank",href:e.downloadUrl}},[r("i",{staticClass:"mdi mdi-download"}),t._v(" Download ")]):"waiting"==e.status?r("el-button",{attrs:{disabled:"",size:"mini",type:"warning"}},[r("i",{staticClass:"mdi mdi-history"}),t._v(" Processing ")]):"failed"==e.status?r("el-button",{attrs:{disabled:"",size:"mini",type:"danger"}},[r("i",{staticClass:"mdi mdi-history"}),t._v(" Failed ")]):t._e()],1)]),r("el-col",{attrs:{xs:2,sm:2,md:2,lg:2,xl:2}},["done"==e.status||"failed"==e.status||"waiting"==e.status?r("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(a){return t.deleteFile(e.session)}}},[r("i",{staticClass:"mdi mdi-delete text-danger",staticStyle:{"font-size":"24px","line-height":"100px",color:"red !important"}})]):t._e()],1)],1)],1)})),t.lists.length<1?r("el-card",{staticClass:"page-header box-card card-base",staticStyle:{border:"1px solid #ebeef5"}},[r("p",{staticClass:"text item",attrs:{align:"center"}},[r("img",{attrs:{src:a("7e53"),width:"120px"}}),r("br"),t._v(" Files you download will appear here ")])]):t._e()],2)],1)],1)]),r("el-tab-pane",{attrs:{label:"HSM Rate",name:"hsmRate"}},[t.showAlertMessage||t.showAlertError?t._e():r("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0}},[r("el-form-item",[r("el-date-picker",{staticStyle:{width:"275px"},attrs:{size:"mini","picker-options":t.pickerOptions,"unlink-panels":!0,editable:!1,type:"daterange","range-separator":"To","start-placeholder":"Start date","end-placeholder":"End date"},model:{value:t.selectedStartDateRate,callback:function(e){t.selectedStartDateRate=e},expression:"selectedStartDateRate"}})],1),r("el-form-item",[r("el-select",{staticStyle:{width:"150px"},attrs:{size:"mini",placeholder:"Select Phone Number","default-first-option":!0},model:{value:t.sender,callback:function(e){t.sender=e},expression:"sender"}},t._l(t.waUserDetail.sender,(function(t){return r("el-option",{key:t,staticStyle:{width:"150px"},attrs:{label:t,value:t}})})),1)],1),r("el-form-item",[r("el-button",{staticClass:"animated fadeInRight",attrs:{type:"primary",size:"mini"},on:{click:t.changeFilterRate}},[r("i",{staticClass:"el-icon-search"})])],1)],1),t.showAlertMessage||t.showAlertError?t._e():r("el-row",{staticStyle:{"z-index":"0"},attrs:{gutter:10}},[r("el-col",{staticClass:"mt-10",attrs:{xs:24,sm:24,md:24,lg:24,xl:24}},[r("el-card",{attrs:{shadow:"card-shadow--small"}},[r("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loadingPage,expression:"loadingPage"}],staticClass:"group-list scrollable only-y"},[[r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loadingHsmRate,expression:"loadingHsmRate"}],staticStyle:{width:"100%",color:"#000 !important"},attrs:{data:t.hsmRateData,"element-loading-text":"Loading...","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(246, 246, 245, 0.8)"}},[r("el-table-column",{attrs:{width:"350",prop:"name",label:"Template Name",fixed:""}}),r("el-table-column",{attrs:{prop:"total",label:"Total",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.total?r("span",[t._v(t._s(e.row.total))]):r("span",[t._v("-")])]}}],null,!1,1187765049)}),r("el-table-column",{attrs:{prop:"sent",label:"Total Sent Message",width:"160"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.delivered||e.row.sent||e.row.read?r("span",[t._v(t._s((e.row.delivered?e.row.delivered:0)+(e.row.sent?e.row.sent:0)+(e.row.read?e.row.read:0)))]):r("span",[t._v("-")])]}}],null,!1,3330215666)}),r("el-table-column",{attrs:{width:"200",prop:"delivered",label:"Total Delivered Message"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.delivered?r("span",[t._v(t._s(e.row.delivered))]):r("span",[t._v("-")])]}}],null,!1,2613386105)}),r("el-table-column",{attrs:{prop:"read",label:"Total Read Message",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.read?r("span",[t._v(t._s(e.row.read))]):r("span",[t._v("-")])]}}],null,!1,2050149689)}),r("el-table-column",{attrs:{prop:"read_rate",label:"Success Rate",width:"140"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.delivered||e.row.sent||e.row.read?r("span",[t._v(" "+t._s((((e.row.delivered?e.row.delivered:0)+(e.row.sent?e.row.sent:0)+(e.row.read?e.row.read:0))/(e.row.total?e.row.total:0)*100).toFixed(2)+" %")+" ")]):r("span",[t._v("-")])]}}],null,!1,3178698925)}),r("el-table-column",{attrs:{prop:"read_rate",label:"Reading Rate",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.read_rate?r("span",[t._v(t._s(e.row.read_rate)+" %")]):r("span",[t._v("-")])]}}],null,!1,1454726263)}),r("template",{staticStyle:{height:"500px"},slot:"empty"},[r("p",[r("img",{attrs:{src:a("7e53"),width:"100"}}),r("br"),t._v("No data ")])])],2)]],2)])],1)],1)],1)],1)],1)],1)},n=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"page-header"},[a("h1",[t._v("Whatsapp Notification Report")])])}],s=(a("7f7f"),a("a481"),a("6762"),a("2fdb"),a("6aa2"),a("ac6a"),a("6b54"),a("7514"),a("96cf"),a("1da1")),o=a("ade3"),i=(a("bce9"),a("271f")),l=a("db49"),c=a("c0d6"),d=a("7f45"),u=a.n(d),p=(a("b730"),a("aeb1")),m=a.n(p),h=a("2ef0"),f=a.n(h),g=a("838b"),b=a.n(g),w=(a("bc3a"),{components:{VueJsonPretty:b.a},data:function(){var t;return t={businessId:"",customer_type:c["a"].getters.customer_type,optionsFilter:[{value:"to",label:"Recipient"},{value:"msg_id",label:"Message ID"},{value:"type",label:"Template Name"}],valueFilter:"to",searchingData:"",timeoutReport:null,selectedRows:{},modalInvalid:!1,activeTab:"report",lists:[],hsmRateData:[],loadingHsmRate:!1,bodyStyle:{padding:"20px"},loadingReportTable:!1,loadingExport:!1,selectedStartDate:[u()().format("YYYY-MM-DD"),u()().format("YYYY-MM-DD")],selectedStartDateRate:[u()().format("YYYY-MM-DD"),u()().format("YYYY-MM-DD")],selectedYear:u()().format("YYYY"),selectedMonth:u()().format("M"),loadingPage:!0,loading:!1,tabLoading:!1,reportTabLoading:!1,loadingTable:!0,reportData:[],dateRange:[new Date,new Date],pickerOptions:{disabledDate:function(t){var e=u()(),a=e.diff(u()(t),"d");return a>90||a<0||0==a&&0==e.isSame(u()(t),"d")}}},Object(o["a"])(t,"loadingExport",!1),Object(o["a"])(t,"pageSize","2"),Object(o["a"])(t,"onPage","1"),Object(o["a"])(t,"totalCount",1e5),Object(o["a"])(t,"resData",[]),Object(o["a"])(t,"messages",[]),Object(o["a"])(t,"startDate",new Date),Object(o["a"])(t,"endDate",new Date),Object(o["a"])(t,"excelFields",{Date:"dateTimeIso",Time:"dateTimeIso",From:"from",To:"to",Delivered:"delivered"}),Object(o["a"])(t,"excelData",[]),Object(o["a"])(t,"excelFilename","Report Notification (Platform by DAMCorp).xls"),Object(o["a"])(t,"pageNotAllowed",!1),Object(o["a"])(t,"showAlertError",!1),Object(o["a"])(t,"showAlertMessage",!1),Object(o["a"])(t,"showFormMessage",!1),Object(o["a"])(t,"options",[{value:"1",label:"Januari"},{value:"2",label:"Februari"},{value:"3",label:"Maret"},{value:"4",label:"April"},{value:"5",label:"Mei"},{value:"6",label:"Juni"},{value:"7",label:"Juli"},{value:"8",label:"Agustus"},{value:"9",label:"September"},{value:"10",label:"Oktober"},{value:"11",label:"November"},{value:"12",label:"Desember"}]),Object(o["a"])(t,"value",u()().format("M")),Object(o["a"])(t,"optionsYear",[]),Object(o["a"])(t,"year","2019"),Object(o["a"])(t,"waUserDetail",{hsm:[],sender:[]}),Object(o["a"])(t,"sender",""),Object(o["a"])(t,"currentPage",1),Object(o["a"])(t,"total",0),Object(o["a"])(t,"dateRange",[new Date,new Date]),Object(o["a"])(t,"quotaLoader",!1),Object(o["a"])(t,"quotaCardLoader",!1),Object(o["a"])(t,"totalBill",0),Object(o["a"])(t,"quota",0),Object(o["a"])(t,"whatsappNumber",[]),Object(o["a"])(t,"whatsappBilling",[]),Object(o["a"])(t,"fillProductNotif",[]),Object(o["a"])(t,"billing_product_log",[]),Object(o["a"])(t,"dataProduct",[]),Object(o["a"])(t,"selectNumber",""),Object(o["a"])(t,"product_type",""),t},methods:{checkBusinessId:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(i["a"])({method:"get",url:"bussiness/checkBusinessId"}).then((function(t){200!=t.data.ec&&"not_subscribe"==t.data.message?e.showAlertMessage=!0:e.businessId=t.data.dataString})).catch((function(t){}));case 2:case"end":return t.stop()}}),t)})));function e(){return t.apply(this,arguments)}return e}(),doSearch:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;"select"==e?""!=this.searchingData&&this.getReport():(clearTimeout(this.timeoutReport),this.timeoutReport=setTimeout((function(){t.currentPage=1,t.getReport()}),1e3))},errorMessage:function(t){return"failed"!=t.status&&"fail"!=t.status||!t.latest_error_message?t.status.charAt(0).toUpperCase()+t.status.slice(1):"Failed. "+t.latest_error_message},callback:function(t){this.onPage=t,this.getReport()},print:function(){window.print()},download:function(){this.getReport("download")},monthName:function(t){var e=f.a.find(this.options,"value");return e.label},format:function(t,e){return u()(t).format(e)},changeFilter:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.currentPage=1,t.next=3,this.getReport(1);case 3:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),changeFilterRate:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.hsmRate();case 2:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),loadWA:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(i["a"])({method:"post",url:l["a"].baseApi+"user/detail/number",data:{channels:"whatsapp"}}).then((function(t){200==t.data.ec?(e.showFormMessage=!0,e.waUserDetail.sender=f.a.uniq(t.data.data),e.sender=e.waUserDetail.sender[0]):400==t.data.ec&&"not_subscribe"==t.data.message?e.showAlertMessage=!0:e.showAlertError=!0})).catch((function(t){e.showAlertError=!0}));case 2:this.loadingPage=!1;case 3:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),getReport:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,a,r,n,s,o=this,c=arguments;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e=c.length>0&&void 0!==c[0]?c[0]:1,a=c.length>1&&void 0!==c[1]?c[1]:"",r=c.length>2&&void 0!==c[2]&&c[2],"download"!=a){t.next=9;break}return n="",t.next=7,this.$confirm("Report will be sent to <b>".concat(this.$store.getters.email,"</b><br/>Continue to generate your report?"),"Confirm",{confirmButtonText:"OK",cancelButtonText:"Cancel",dangerouslyUseHTMLString:!0,type:"warning",center:!0}).then((function(){})).catch((function(){n="cancel"}));case 7:if("cancel"!=n){t.next=9;break}return t.abrupt("return");case 9:return this.showAlertError=!1,this.loadingTable=!0,this,s={url:l["a"].baseApi+"user/report/notification?page="+e,method:"post",params:{view:1==r||null},data:{year:this.year.toString(),month:this.value,number:this.sender,startDate:u()(this.selectedStartDate[0]).format("YYYY-MM-DD"),endDate:u()(this.selectedStartDate[1]).format("YYYY-MM-DD")}},"download"==a&&(s.url+="&download"),this.searchingData&&(s.data.search_type=this.valueFilter,s.data.search=this.searchingData),t.next=17,Object(i["a"])(s).then((function(t){var e=u()([o.year,o.value-1]).endOf("month").format("DD MMM YYYY"),r="";if(r=o.value==u()().month()+1&&o.year==u()().year()?u()().format("DD MMM YYYY"):e,200==t.data.ec&&"download"!=a?(o.resData=t.data.data,o.messages=t.data.data.messages,o.month=o.value,o.total=t.data.data.total):o.$swal(o.$t("success"),"We will process your request. Please wait for a while. Thank you!","success"),-1==t.headers["content-type"].indexOf("application/json"))try{var n=window.URL.createObjectURL(new Blob([t.data],{type:t.headers["content-type"]})),s=document.createElement("a");s.href=n,s.setAttribute("download","Report Notification (Platform by DAMCorp) ("+r+").xls"),s.click()}catch(i){}else 200!=t.data.ec&&("waiting"==t.data.message?o.$swal(o.$t("error"),"Please wait until you first request done and you can resubmit request for report download","error"):o.$swal(o.$t("error"),o.$t("error_text"),"error"))})).catch((function(t){"download"==a&&(o.showAlertError=!0)}));case 17:this.loadingTable=!1;case 18:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),exportExcel:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,a=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.loadingExport=!0,this,e={url:l["a"].baseApi+"user/report/notification?export",method:"post",data:{year:this.year.toString(),month:this.value,startDate:u()(this.dateRange[0]).format("YYYY-MM-DD"),endDate:u()(this.dateRange[1]).format("YYYY-MM-DD"),number:this.sender}},t.next=5,Object(i["a"])(e).then((function(t){if(200==t.data.ec){var e=t.data.data.messages;e=f.a.orderBy(e,(function(t){return new u.a(t.dateTimeIso)}),["desc"]);var a=e,r=0,n="";n+="\t\t\tReport Notification\t\t\n",n+="\t\t\tPlatform by DAMCorp.\t\t\n",n+="No\tDate\tTime\tFrom\tTo\tType\tStatus\n",a.forEach((function(t){r++,n+=r+"\t",n+=u()(t.dateTimeIso).local().format("YYYY-MM-DD")+"\t",n+=u()(t.dateTimeIso).local().format("HH:mm")+"\t",n+=t.from+"\t",n+=t.to+"\t",n+=t.type+"\t",n+=t.status+"\t",n+="\r\n"}));var s=window.btoa(window.unescape(encodeURIComponent(n))),o=atob(s),i=o.length,l=new Uint8ClampedArray(i);while(i--)l[i]=o.charCodeAt(i);var c="Report_Notification.xls",d="application/vnd.ms-excel",p=new Blob([l],{type:d});m()(p,c,d)}})).catch((function(t){a.$swal(a.$t("error"),a.$t("download_failed_text"),"warning")}));case 5:this.loadingExport=!1;case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),paginateReport:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.currentPage=e,t.next=3,this.getReport(this.currentPage);case 3:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),hsmRate:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.loadingHsmRate=!0,t.next=3,Object(i["a"])({method:"post",url:l["a"].baseApi+"user/report/hsmRate",data:{number:this.sender,startDate:u()(this.selectedStartDateRate[0]).format("YYYY-MM-DD"),endDate:u()(this.selectedStartDateRate[1]).format("YYYY-MM-DD")}}).then((function(t){var a=t.data;200==a.ec&&(e.hsmRateData=t.data.data.rank)}));case 3:this.loadingHsmRate=!1;case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),loadData:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.reportTabLoading=!0,t.next=3,Object(i["a"])({method:"get",url:"report/list"}).then((function(t){var a=t.data;200==a.ec&&(e.lists=a.data.map((function(t){return t.title="Report "+t.customerName,t.downloadUrl=t.url?t.url.secure_url:null,t})))}));case 3:this.reportTabLoading=!1;case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),deleteFile:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(e){var a=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.$confirm("You will permanently delete this file. Are you sure?","Confirm",{confirmButtonText:"Sure",cancelButtonText:"Cancel",dangerouslyUseHTMLString:!0,type:"warning",center:!0});case 3:return this.reportTabLoading=!0,t.next=6,Object(i["a"])({method:"delete",url:"report/"+e}).then((function(t){200==t.data.ec?a.$swal(a.$t("success"),"","success"):a.$swal(a.$t("error"),"Sorry, delete file failed. Please try again","error")})).catch((function(t){a.$swal(a.$t("error"),a.$t("error_text"),"error")}));case 6:this.reportTabLoading=!1,this.loadData(),t.next=12;break;case 10:t.prev=10,t.t0=t["catch"](0);case 12:case"end":return t.stop()}}),t,this,[[0,10]])})));function e(e){return t.apply(this,arguments)}return e}(),loadReport:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,a,r,n,s,o=this,c=arguments;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e=c.length>0&&void 0!==c[0]?c[0]:1,a=c.length>1?c[1]:void 0,"download"!=a){t.next=8;break}return r="",t.next=6,this.$confirm("You will request notification report.<br/><b>You may not request any report until this process is finish.</b> Continue request report?","Confirm",{confirmButtonText:"OK",cancelButtonText:"Cancel",dangerouslyUseHTMLString:!0,type:"warning",center:!0}).then((function(){})).catch((function(){r="cancel"}));case 6:if("cancel"!=r){t.next=8;break}return t.abrupt("return");case 8:return this,n=this.$store.getters.customerID,s={url:l["a"].baseApi+"user/"+n+"/report/notification?page="+e,method:"post",data:{year:this.selectedYear.toString(),startDate:u()(this.selectedStartDate[0]).format("YYYY-MM-DD"),endDate:u()(this.selectedStartDate[1]).format("YYYY-MM-DD"),number:this.sender}},"download"==a&&(s.url=l["a"].baseApi+"user/".concat(n,"/report/notification/download"),s.method="get",s.params=s.data,delete s.data),t.next=14,Object(i["a"])(s).then((function(t){"download"==a?200==t.data.ec?(o.$swal(o.$t("success"),"We will process your request. Please wait for a while. Thank you!","success"),o.activeTab="report",o.reportTabLoading=!0,o.loadData()):"waiting"==t.data.message?o.$swal(o.$t("warning"),"You may not request any report for this company until last request was finished","warning"):o.$swal(o.$t("error"),o.$t("error_text"),"error"):(200==t.data.ec&&(o.resData=t.data.data,o.dataMessages=t.data.data.messages,o.month=t.data.data.month,o.totalMessages=parseInt(t.data.data.total),o.status=t.data.data.status),o.resData)})).catch((function(t){o.showAlertError=!0}));case 14:this.reportTabLoading=!1;case 15:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),downloadExcel:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.loadingExport=!0,t.next=3,this.loadReport(1,"download");case 3:this.loadingExport=!1;case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),wa_billing:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,a=this,r=arguments;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r.length>0&&void 0!==r[0]?r[0]:"",this.quotaCardLoader=!0,e={url:l["a"].baseApi+"/user/billing",method:"post",data:{months:u()().format("YYYY-MM"),with_date:!0},timeout:9e4},this.totalBill=0,t.next=6,Object(i["a"])(e).then((function(t){var e=new Array,r=new Array,n=0;if(200==t.data.ec){a.dataProduct=t.data.data.billing,a.billing_product_log=t.data.data.update_log;var s=t.data.data.billing;t.data.data.update_log;f.a.forEach(s,(function(t){e.push(t.phone_number),r[n]=new Array;var s=new Array,o=0;f.a.forEach(t.billing,(function(e){var i={product:e.product,delivered:e.delivered,total:e.billing,detail:e.detail};if(e.serviceFee)a.totalBill+=parseFloat(e.serviceFee),s.push({product:{productName:"Service Fee",type:""},delivered:"",total:parseFloat(e.serviceFee)});else{var l=0;e.detail&&(e.detail.forEach((function(t){l+=parseFloat(t.serviceFee)})),a.totalBill+=parseFloat(l),s.push({product:{productName:"Service Fee",type:""},delivered:"",total:parseFloat(l)}))}e.billingTax&&(a.totalBill+=parseFloat(e.billingTax),s.push({product:{productName:e.product.productName+" Tax",type:""},delivered:"",total:parseFloat(e.billingTax)})),r[n].push(i),o+1==t.billing.length&&f.a.forEach(s,(function(t){r[n].push(t)})),Array.isArray(e.detail)?e.detail.forEach((function(t){a.totalBill+=t.total})):a.totalBill+=e.billing,o++})),n++})),a.whatsappNumber=e,a.whatsappBilling=r,a.selectNumber=a.whatsappNumber[0],a.handleChangeQuota()}else a.dataProduct=[];a.quotaCardLoader=!1})).catch((function(t){a.dataProduct=[]}));case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),handleChangeQuota:function(){var t=this;this.product_type="";var e=f.a.find(this.dataProduct,(function(e){return e.phone_number==t.selectNumber}));e&&e.billing.length>0&&(this.fillProductNotif=e.billing.filter((function(t){return t.product.productName.includes("Whatsapp Notification")})),this.fillProductNotif.length>0&&(this.fillProductNotif.forEach((function(t){t.product.alias=t.product.type.replace(/_/g," ").replace(/(^\w{1})|(\s+\w{1})/g,(function(t){return t.toUpperCase()}))})),""==this.product_type&&(this.product_type=this.fillProductNotif[0].product._id),this.handleChangeProduct()))},handleChangeProduct:function(){var t=this;this.quotaLoader=!0;var e=0,a=f.a.find(this.fillProductNotif,(function(e){return e.product._id==t.product_type})),r=a.product.count||0;r+=a.product.monthly_free_count||0,e=a.detail&&a.detail>0?a.detail.filter((function(t){return"+62"==t.countryCode})).reduce((function(t,e){return t+e.count}),0)||0:a.delivered,this.quota=r-e,this.quota<0&&(this.quota="-"),this.quotaLoader=!1},tabClick:function(t){"download"==t.name?this.getReport():"hsmRate"==t.name?this.hsmRate():this.loadData()}},computed:{},mounted:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,a,r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:for(this.checkBusinessId(),this.customer_type,this.loadData(),e=[],a=0,r=(new Date).getFullYear(),n=(new Date).getFullYear()-2,a=r;a>=n;a--)e.push({value:a,label:a});return this.optionsYear=e,t.next=11,this.loadWA();case 11:if(this.wa_billing(),this.hsmRate(),0!=this.showAlertError||0!=this.showAlertMessage){t.next=18;break}return t.next=16,this.getReport(this.currentPage,"",!0);case 16:t.next=19;break;case 18:this.loadingPage=!1;case 19:this.monthName(1);case 20:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()}),v=w,y=(a("255f"),a("2877")),x=Object(y["a"])(v,r,n,!1,null,null,null);e["default"]=x.exports}}]);